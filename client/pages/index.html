<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Omeglo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

<style>
body{margin:0;background:#0e0f13;color:#fff;font-family:Arial}
header{padding:12px;background:#4f46e5;font-size:20px}
#landing{position:fixed;inset:0;background:#0e0f13;display:flex;align-items:center;justify-content:center;z-index:10}
#box{background:#12141c;padding:20px;border:1px solid #333}
#chat{display:flex;height:calc(100vh - 50px)}
#left{width:300px;padding:10px}
#right{flex:1;padding:10px;display:flex;flex-direction:column}
#msgs{flex:1;background:#12141c;border:1px solid #333;overflow:auto;padding:10px}
.msg{margin-bottom:6px}
.me{color:#60a5fa}
.stranger{color:#a78bfa}
button{margin:3px}
</style>
</head>

<body>

<header>
  Omeglo | Online: <span id="online">0</span>
</header>

<!-- LANDING -->
<div id="landing">
  <div id="box">
    <input id="interest" placeholder="Interests (comma separated)">
    <br><br>
    <button onclick="start()">START</button>
  </div>
</div>

<div id="chat">
  <div id="left">
    <button onclick="fullscreen()">Fullscreen</button>
    <button onclick="report()">Report</button>
  </div>

  <div id="right">
    <div id="status">Connecting…</div>
    <div id="msgs"></div>
    <div>
      <input id="msg" placeholder="Type message">
      <button onclick="send()">Send</button>
      <button onclick="next()">Next</button>
    </div>
  </div>
</div>

<script>
const socket = io("https://omeglo-server.onrender.com", {
  transports:["websocket"]
});

const online = document.getElementById("online");
const statusEl = document.getElementById("status");
const msgs = document.getElementById("msgs");
const landing = document.getElementById("landing");
const input = document.getElementById("msg");
const interestInput = document.getElementById("interest");

socket.on("connect", ()=>{
  socket.emit("force-online-check");
  statusEl.innerText="Connected. Click Start.";
});

socket.on("online-count", n=>{
  online.innerText=n;
});

socket.on("waiting", ()=>{
  statusEl.innerText="Waiting for stranger…";
});

socket.on("matched", ()=>{
  statusEl.innerText="Connected with stranger";
});

socket.on("partner_left", ()=>{
  statusEl.innerText="Stranger left";
});

socket.on("message", msg=>{
  add("stranger", msg);
});

socket.on("banned", msg=>{
  alert(msg);
  location.reload();
});

function add(type,text){
  const d=document.createElement("div");
  d.className="msg "+type;
  d.innerText=(type==="me"?"You: ":"Stranger: ")+text;
  msgs.appendChild(d);
  msgs.scrollTop=msgs.scrollHeight;
}

function send(){
  const t=input.value.trim();
  if(!t) return;
  socket.emit("message", t);
  add("me", t);
  input.value="";
}

function next(){
  msgs.innerHTML="";
  socket.emit("next");
}

function start(){
  landing.style.display="none";
  socket.emit("setInterests", interestInput.value); // future use
  socket.emit("join");
}

function report(){
  socket.emit("report");
  alert("User reported");
}

function fullscreen(){
  document.documentElement.requestFullscreen();
}
</script>

</body>
</html>
